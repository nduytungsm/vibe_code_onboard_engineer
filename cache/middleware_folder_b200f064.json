{
  "content_hash": "a39a396da209b93be07252510c313fc4",
  "timestamp": "2025-09-23T16:09:21.518992+07:00",
  "result": {
    "path": "middleware",
    "purpose": "This folder/module is responsible for implementing various middleware functions for an Echo web server application, including error handling, authentication, and request logging.",
    "languages": {
      "Go": 6
    },
    "key_modules": [
      "custom_requests_total_prometheus.go",
      "error_handler.go",
      "internal_auth.go",
      "latency_alert.go",
      "private_mode.go",
      "wallet_auth.go"
    ],
    "dependencies": [
      "github.com/labstack/echo/v4",
      "github.com/labstack/echo-contrib/echoprometheus",
      "github.com/prometheus/client_golang/prometheus",
      "github.com/rs/zerolog/log",
      "github.com/golang-jwt/jwt",
      "github.com/jackc/pgconn",
      "github.com/axieinfinity/ecosystem-go-common/errors",
      "github.com/axieinfinity/ecosystem-go-common/validation",
      "github.com/axieinfinity/ecosystem-go-common/hmac",
      "github.com/axieinfinity/ronin-wallet-proxy/pkg/crypto/hmac",
      "github.com/axieinfinity/ronin-wallet-proxy/pkg/helper"
    ],
    "architecture": "The folder follows a modular architecture pattern, where each middleware file encapsulates specific functionality, promoting separation of concerns and reusability.",
    "file_summaries": {
      "middleware/custom_requests_total_prometheus.go": {
        "language": "Go",
        "purpose": "This file defines a middleware for tracking custom HTTP request metrics using Prometheus.",
        "key_types": [
          "echo.MiddlewareFunc",
          "prometheus.CounterVec",
          "prometheus.CounterOpts"
        ],
        "functions": [
          "NewCustomRequestsTotalPrometheus"
        ],
        "imports": [
          "strconv",
          "github.com/labstack/echo-contrib/echoprometheus",
          "github.com/labstack/echo/v4",
          "github.com/prometheus/client_golang/prometheus",
          "github.com/rs/zerolog/log"
        ],
        "side_effects": [
          "Registers a new Prometheus counter metric",
          "Logs fatal errors if metric registration fails"
        ],
        "risks": [
          "Potential for panic if type assertions fail",
          "Logging sensitive information if not handled properly"
        ],
        "complexity": "medium"
      },
      "middleware/error_handler.go": {
        "language": "Go",
        "purpose": "Handles global errors for an Echo web server application.",
        "key_types": [
          "error",
          "echo.Context",
          "mErrs.HTTPError",
          "jwt.ValidationError",
          "pgconn.PgError",
          "validation.Errors"
        ],
        "functions": [
          "GlobalErrorHandler",
          "Init"
        ],
        "imports": [
          "context",
          "errors",
          "fmt",
          "net/http",
          "net/url",
          "slices",
          "strings",
          "github.com/golang-jwt/jwt",
          "github.com/jackc/pgconn",
          "github.com/labstack/echo/v4",
          "github.com/labstack/echo/v4/middleware",
          "github.com/axieinfinity/ecosystem-go-common/errors",
          "github.com/axieinfinity/ecosystem-go-common/validation",
          "github.com/axieinfinity/ronin-wallet-proxy/pkg/helper"
        ],
        "side_effects": [
          "Logs errors to the context's logger",
          "Sends JSON response with error details to the client"
        ],
        "risks": [
          "Potential exposure of sensitive error details in logs",
          "Improper handling of JWT errors may lead to unauthorized access"
        ],
        "complexity": "medium"
      },
      "middleware/internal_auth.go": {
        "language": "Go",
        "purpose": "This file implements HMAC authentication middleware for validating HMAC signatures in HTTP requests.",
        "key_types": [
          "Config",
          "MiddlewareFunc",
          "Context"
        ],
        "functions": [
          "HmacAuthentication"
        ],
        "imports": [
          "fmt",
          "net/http",
          "strings",
          "github.com/labstack/echo/v4",
          "github.com/axieinfinity/ecosystem-go-common/errors",
          "github.com/axieinfinity/ecosystem-go-common/hmac",
          "github.com/axieinfinity/ronin-wallet-proxy/pkg/crypto/hmac",
          "github.com/axieinfinity/ronin-wallet-proxy/pkg/helper"
        ],
        "side_effects": [
          "Modifies the request context based on authentication results."
        ],
        "risks": [
          "Potential exposure of sensitive information if error messages are not properly handled."
        ],
        "complexity": "medium"
      },
      "middleware/latency_alert.go": {
        "language": "Go",
        "purpose": "Defines a middleware function to log requests that exceed a specified latency threshold.",
        "key_types": [
          "time.Duration",
          "echo.MiddlewareFunc",
          "echo.HandlerFunc",
          "echo.Context"
        ],
        "functions": [
          "NewLatencyAlert"
        ],
        "imports": [
          "strconv",
          "time",
          "github.com/labstack/echo/v4",
          "github.com/rs/zerolog/log"
        ],
        "side_effects": [
          "Logs a warning message if the request latency exceeds the threshold."
        ],
        "risks": [
          "Potential information leakage through logged request details."
        ],
        "complexity": "medium"
      },
      "middleware/private_mode.go": {
        "language": "Go",
        "purpose": "Defines a middleware function for private mode access control based on an API key.",
        "key_types": [
          "echo.MiddlewareFunc",
          "echo.HandlerFunc",
          "echo.Context"
        ],
        "functions": [
          "PrivateMode"
        ],
        "imports": [
          "net/http",
          "github.com/labstack/echo/v4"
        ],
        "side_effects": [
          "Returns HTTP 401 Unauthorized if the API key does not match."
        ],
        "risks": [
          "Potential exposure of API key if not handled securely."
        ],
        "complexity": "medium"
      },
      "middleware/wallet_auth.go": {
        "language": "Go",
        "purpose": "This file implements middleware for verifying wallet signatures in HTTP requests.",
        "key_types": [
          "hmac.Config",
          "echo.Context",
          "error"
        ],
        "functions": [
          "VerifyWalletSignature",
          "newClockSkewValidator"
        ],
        "imports": [
          "fmt",
          "math",
          "net/http",
          "sort",
          "strings",
          "time",
          "github.com/labstack/echo/v4",
          "github.com/rs/zerolog/log",
          "github.com/axieinfinity/ecosystem-go-common/errors",
          "github.com/axieinfinity/ronin-wallet-proxy/pkg/crypto/hmac",
          "github.com/axieinfinity/ronin-wallet-proxy/pkg/helper"
        ],
        "side_effects": [
          "Logs request information"
        ],
        "risks": [
          "Potential exposure of sensitive information through logs"
        ],
        "complexity": "medium"
      }
    }
  }
}